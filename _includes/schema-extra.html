{% comment %}
Elite-level dynamic schema for Blog index and Blog posts
Uses jekyll-last-modified-at for accurate dateModified values.
{% endcomment %}

{% if page.layout == "home" or page.url == site.baseurl or page.url == site.baseurl | append: "/" %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [

    /* ===== WebSite entity ===== */
    {
      "@type": "WebSite",
      "@id": "{{ site.schema.website_id }}",
      "url": "{{ site.schema.url }}{{ site.baseurl }}/",
      "name": "{{ site.title | escape }}",
      "publisher": { "@id": "{{ site.schema.person_id }}" },
      "inLanguage": "{{ site.lang }}",
      "mainEntityOfPage": {
        "@id": "{{ site.schema.url }}{{ site.baseurl }}{% if paginator.page > 1 %}/page{{ paginator.page }}/{% endif %}#webpage"
      }
    },

    /* ===== WebPage entity ===== */
    {
      "@type": "WebPage",
      "@id": "{{ site.schema.url }}{{ site.baseurl }}{% if paginator.page > 1 %}/page{{ paginator.page }}/{% endif %}#webpage",
      "url": "{{ site.schema.url }}{{ site.baseurl }}{% if paginator.page > 1 %}/page{{ paginator.page }}/{% endif %}",
      "name": {{ page.title | default: "مدونة " | append: site.title | jsonify }},
      "inLanguage": "{{ site.lang }}",
      "isPartOf": { "@id": "{{ site.schema.website_id }}" },
      {% if paginator.page == 1 %}
      "mainEntity": { "@id": "{{ site.schema.url }}{{ site.baseurl }}/#blog" },
      {% endif %}
      "breadcrumb": { "@id": "{{ site.schema.url }}{{ site.baseurl }}{% if paginator.page > 1 %}/page{{ paginator.page }}/{% endif %}#breadcrumb" },
      {%- comment -%}
      "alternatePage": [
        {
          "@type": "WebPage",
          "url": "{{ site.schema.url }}/en/blog/",
          "inLanguage": "en",
          "name": "Ahmad Al Khatib Blog"
        }
      ],
      {%- endcomment -%}
      "primaryImageOfPage": {
        "@type": "ImageObject",
        "url": "{{ site.schema.url }}{{ site.social_preview_image | default: site.schema.default_image }}",
        "width": {{ site.schema.image.width }},
        "height": {{ site.schema.image.height }},
        "caption": "صورة المدونة الرئيسية لأحمد الخطيب",
        "representativeOfPage": true
      }
    },

    /* ===== BreadcrumbList ===== */
    {
      "@type": "BreadcrumbList",
      "@id": "{{ site.schema.url }}{{ site.baseurl }}{% if paginator.page > 1 %}/page{{ paginator.page }}/{% endif %}#breadcrumb",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "{{ site.schema.breadcrumb.home_name }}", "item": "{{ site.schema.url }}/" },
        { "@type": "ListItem", "position": 2, "name": "{{ site.schema.breadcrumb.blog_name }}", "item": "{{ site.schema.url }}{{ site.baseurl }}/" }
        {% if paginator.page > 1 %},
        { "@type": "ListItem", "position": 3, "name": "صفحة {{ paginator.page }}", "item": "{{ site.schema.url }}{{ site.baseurl }}/page{{ paginator.page }}/" }
        {% endif %}
      ]
    },

    /* ===== Blog entity ===== */
    {
      "@type": "Blog",
      "@id": "{{ site.schema.url }}{{ site.baseurl }}/#blog",
      "url": "{{ site.schema.url }}{{ site.baseurl }}/",
      "name": {{ page.title | default: "مدونة " | append: site.title | jsonify }},
      "description": {{ page.description | default: site.description | jsonify }},
      "publisher": { "@id": "{{ site.schema.person_id }}" },
      "author": { "@id": "{{ site.schema.person_id }}" },
      "inLanguage": "{{ site.lang }}",
      "dateCreated": "{% assign first_post = site.posts | last %}{{ first_post.date | date_to_xmlschema }}",
      "dateModified": "{{ page.last_modified_at | date_to_xmlschema }}",
      "mainEntityOfPage": {
        "@id": "{{ site.schema.url }}{{ site.baseurl }}{% if paginator.page > 1 %}/page{{ paginator.page }}/{% endif %}#webpage"
      },
      "about": [
        {% assign blog_about = site.posts | map: "tags" | concat: site.posts | map: "categories" | uniq | flatten | compact %}
        {% for item in blog_about %}
          { "@type": "Thing", "name": {{ item | jsonify }} }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ],
      "genre": [
        {% assign blog_genre = site.posts | map: "categories" | uniq | flatten | compact %}
        {% if blog_genre == empty %}
          {% assign blog_genre = site.schema.default_genre %}
        {% endif %}
        {% for g in blog_genre %}
          {{ g | jsonify }}{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ],
      "contentLocation": { "@type": "Place", "name": "{{ site.schema.content_location }}" },
      "image": {
        "@type": "ImageObject",
        "url": "{{ site.schema.url }}{{ site.social_preview_image | default: site.schema.default_image }}",
        "contentUrl": "{{ site.schema.url }}{{ site.social_preview_image | default: site.schema.default_image }}",
        "width": {{ site.schema.image.width }},
        "height": {{ site.schema.image.height }}
      },
      "potentialAction": [
        {
          "@type": "ReadAction",
          "target": "{{ site.schema.url }}{{ site.baseurl }}/",
          "name": "قراءة {{ site.schema.breadcrumb.blog_name }}"
        }
      ]
    },

    /* ===== ItemList of posts ===== */
    {
      "@type": "ItemList",
      "@id": "{{ site.schema.url }}{{ site.baseurl }}/#list",
      "url": "{{ site.schema.url }}{{ site.baseurl }}/",
      "name": "أحدث المقالات",
      "mainEntityOfPage": {
        "@id": "{{ site.schema.url }}{{ site.baseurl }}{% if paginator.page > 1 %}/page{{ paginator.page }}/{% endif %}#webpage"
      },
      "itemListElement": [
        {% assign counter = 1 %}
        {% for post in paginator.posts %}
        {
          "@type": "ListItem",
          "position": {{ counter }},
          "url": "{{ site.schema.url }}{{ post.url }}",
          "name": {{ post.title | jsonify }}{% if post.image %},
          "image": {
            "@type": "ImageObject",
            "url": "{{ site.schema.url }}{{ post.image.path | default: post.image | default: site.schema.default_image }}",
            "contentUrl": "{{ site.schema.url }}{{ post.image.path | default: post.image | default: site.schema.default_image }}",
            "width": {{ site.schema.image.width }},
            "height": {{ site.schema.image.height }}
          }{% endif %}
        }{% if forloop.last == false %},{% endif %}
        {% assign counter = counter | plus: 1 %}
        {% endfor %}
      ]
    },

    /* ===== Person entity ===== */
    {
      "@type": "Person",
      "@id": "{{ site.schema.person_id }}",
      "name": "{{ site.schema.publisher_name }}",
      "jobTitle": "{{ site.schema.person.job_title }}",
      "mainEntityOfPage": {
        "@id": "{{ site.schema.url }}{{ site.baseurl }}{% if paginator.page > 1 %}/page{{ paginator.page }}/{% endif %}#webpage"
      },
      "sameAs": [
          "https://ahmad-khatib.com/",
          "https://ahmad-khatib.com/blog/",
          "https://ahmad-khatib.com/about/",
          "https://www.linkedin.com/in/alkhatibahmad/",
          "https://twitter.com/alkhatib_ahmad1",
          "https://github.com/AhmadAl-Khatib",
          "https://www.facebook.com/ahmad.khatib.9237244",
          "https://www.instagram.com/alkhatib_ahmad1/",
          "https://www.youtube.com/@alkhatib_ahmad1",
          "https://www.tiktok.com/@alkhatib_ahmad1",
          "https://www.snapchat.com/add/alkhatib_ahmad1",
          "https://www.amazon.com/author/ahmadalkhatib/",
          "https://www.goodreads.com/author/show/981744.Ahmad_Al_Khatib/"
      ]
    }

  ]
}
</script>

{% endif %}

{% if page.layout == "post" %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [

    /* ===== WebSite entity ===== */
    {
      "@type": "WebSite",
      "@id": "{{ site.schema.website_id }}",
      "url": "{{ site.schema.url }}{{ site.baseurl }}/",
      "name": "{{ site.title | escape }}",
      "publisher": { "@id": "{{ site.schema.person_id }}" },
      "inLanguage": "{{ site.lang }}",
      "mainEntityOfPage": {
        "@id": "{{ site.schema.url }}{{ page.url }}#webpage"
      }
    },

    /* ===== WebPage entity ===== */
    {
      "@type": "WebPage",
      "@id": "{{ site.schema.url }}{{ page.url }}#webpage",
      "url": "{{ site.schema.url }}{{ page.url }}",
      "name": "{{ page.title | escape }}",
      "inLanguage": "{{ page.lang | default: site.lang }}",
      "isPartOf": { "@id": "{{ site.schema.website_id }}" },
      "breadcrumb": { "@id": "{{ site.schema.url }}{{ page.url }}#breadcrumb" },
      "primaryImageOfPage": {
        "@type": "ImageObject",
        "url": "{{ site.schema.url }}{{ page.image | default: site.schema.default_image }}",
        "width": {{ site.schema.image.width }},
        "height": {{ site.schema.image.height }},
        "caption": "الصورة الرئيسية للمقالة",
        "representativeOfPage": true
      },
      "description": "{{ page.description | escape | strip_newlines }}",
      "mainEntity": { "@id": "{{ site.schema.url }}{{ page.url }}#blogposting" },
      {%- comment -%}
      "alternatePage": [
        {
          "@type": "WebPage",
          "url": "{{ site.schema.url }}/en{{ page.url }}",
          "inLanguage": "en",
          "name": "Ahmad Al Khatib – {{ page.title | escape }}"
        }
      ],
      {%- endcomment -%}
      "potentialAction": [
        { "@type": "ReadAction", "target": ["{{ site.schema.url }}{{ page.url }}"] },
        { "@type": "CommentAction", "target": ["{{ site.schema.url }}{{ page.url }}#comments"] }
      ]
    },

    /* ===== BreadcrumbList ===== */
    {
      "@type": "BreadcrumbList",
      "@id": "{{ site.schema.url }}{{ page.url }}#breadcrumb",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "{{ site.schema.breadcrumb.home_name }}",
          "item": "{{ site.schema.url }}/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "{{ site.schema.breadcrumb.blog_name }}",
          "item": "{{ site.schema.url }}{{ site.baseurl }}/"
        }
        {% if page.categories.size > 0 %}
          {% assign pos = 3 %}
          {% for cat in page.categories %}
          ,{
            "@type": "ListItem",
            "position": {{ pos }},
            "name": "{{ cat | escape }}",
            "item": "{{ site.schema.url }}{{ site.baseurl }}/categories/{{ cat | slugify }}/"
          }
          {% assign pos = pos | plus: 1 %}
          {% endfor %}
        {% endif %}
      ]
    },

    /* ===== BlogPosting entity ===== */
    {
      "@type": "BlogPosting",
      "@id": "{{ site.schema.url }}{{ page.url }}#blogposting",
      "headline": "{{ page.title | escape }}",
      "description": "{{ page.description | escape | strip_newlines }}",
      "image": {
        "@type": "ImageObject",
        "@id": "{{ site.schema.url }}{{ page.image | default: site.schema.default_image }}#primaryimage",
        "url": "{{ site.schema.url }}{{ page.image | default: site.schema.default_image }}",
        "contentUrl": "{{ site.schema.url }}{{ page.image | default: site.schema.default_image }}",
        "width": {{ site.schema.image.width }},
        "height": {{ site.schema.image.height }}
      },
      "author": { "@id": "{{ site.schema.person_id }}" },
      "publisher": { "@id": "{{ site.schema.person_id }}" },
      "dateCreated": "{{ page.date_created | date_to_xmlschema | default: page.date | date_to_xmlschema }}",
      "datePublished": "{{ page.date | date_to_xmlschema }}",
      "dateModified": "{{ page.last_modified_at | date_to_xmlschema | default: page.date | date_to_xmlschema }}",
      "mainEntityOfPage": { "@id": "{{ site.schema.url }}{{ page.url }}#webpage" },
      "mainEntity": { "@id": "{{ site.schema.url }}{{ site.baseurl }}/#blog" },
      "isPartOf": { "@id": "{{ site.schema.url }}{{ site.baseurl }}/#blog" },
      "articleSection": "{{ page.categories[0] | default: '' }}",
      "inLanguage": "{{ page.lang | default: site.lang }}",
      "keywords": [
        {% assign all_keywords = page.tags | default: empty %}
        {% assign all_keywords = all_keywords | concat: page.categories | default: empty %}
        {% assign all_keywords = all_keywords | uniq | compact %}
        {% for kw in all_keywords %}
          {{ kw | strip | jsonify }}{% unless forloop.last %}, {% endunless %}
        {% endfor %}
      ],
      "wordCount": "{{ page.content | number_of_words }}",
      "about": [
        {% assign about_array = page.tags | default: empty %}
        {% assign about_array = about_array | concat: page.categories | default: empty %}
        {% if page.schema_about %}
          {% assign schema_about_array = page.schema_about | split: "," %}
          {% assign about_array = about_array | concat: schema_about_array %}
        {% endif %}
        {% assign about_array = about_array | uniq | compact %}
        {% for item in about_array %}
          { "@type": "Thing", "name": {{ item | strip | jsonify }} }{% unless forloop.last %}, {% endunless %}
        {% endfor %}
      ],
      "genre": [
        {% assign genre_array = page.genre | default: empty %}
        {% if genre_array == empty %}{% assign genre_array = page.categories | default: empty %}{% endif %}
        {% if genre_array == empty %}{% assign genre_array = page.tags | default: empty %}{% endif %}
        {% if genre_array == empty %}{% assign genre_array = "مدونة" | split: "," %}{% endif %}
        {% assign genre_array = genre_array | uniq | compact %}
        {% for g in genre_array %}
          {{ g | jsonify }}{% unless forloop.last %}, {% endunless %}
        {% endfor %}
      ],
      {% if page.content_location %}
      "contentLocation": { "@type": "Place", "name": "{{ page.content_location }}" }
      {% else %}
      "contentLocation": { "@type": "Place", "name": "{{ site.schema.content_location }}" }
      {% endif %}
    },

    /* ===== Person entity ===== */
    {
      "@type": "Person",
      "@id": "{{ site.schema.person_id }}",
      "name": "{{ site.schema.publisher_name }}",
      "jobTitle": "{{ site.schema.person.job_title }}",
      "mainEntityOfPage": {
        "@id": "{{ site.schema.url }}{{ page.url }}#webpage"
      },
      "sameAs": [
          "https://ahmad-khatib.com/",
          "https://ahmad-khatib.com/blog/",
          "https://ahmad-khatib.com/about/",
          "https://www.linkedin.com/in/alkhatibahmad/",
          "https://twitter.com/alkhatib_ahmad1",
          "https://github.com/AhmadAl-Khatib",
          "https://www.facebook.com/ahmad.khatib.9237244",
          "https://www.instagram.com/alkhatib_ahmad1/",
          "https://www.youtube.com/@alkhatib_ahmad1",
          "https://www.tiktok.com/@alkhatib_ahmad1",
          "https://www.snapchat.com/add/alkhatib_ahmad1",
          "https://www.amazon.com/author/ahmadalkhatib/",
          "https://www.goodreads.com/author/show/981744.Ahmad_Al_Khatib/"
      ]
    },

    /* ===== Blog container entity ===== */
    {
      "@type": "Blog",
      "@id": "{{ site.schema.url }}{{ site.baseurl }}/#blog",
      "name": "{{ site.title | escape }}",
      "url": "{{ site.schema.url }}{{ site.baseurl }}/",
      "publisher": { "@id": "{{ site.schema.person_id }}" }
    }

  ]
}
</script>
{% endif %}